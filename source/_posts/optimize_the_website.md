---
title: Web前端应该从哪些方面来优化网站
author: 胖芮
avatar: /images/pangrui.png
authorLink: http://www.ruizhengyun.cn
authorAbout: http://www.ruizhengyun.cn
authorDesc: 不论我码不码代码，我都是一枚快乐的前端
categories: 前端
tags: 性能
abbrlink: c50a8aa7
date: 2016-10-07 15:51:27
---
首先，前端是庞大的，包括 `HTML、 CSS、 Javascript、Image 、Flash` 等等各种各样的资源。
所以，前端优化是复杂的，针对方方面面的资源都有不同的方式。那么，前端优化的目的是什么?
* 从用户角度而言，优化能够让页面加载得更快、对用户的操作响应得更及时，能够给用户提供更为友好的体验。
* 从服务商角度而言，优化能够减少页面请求数、或者减小请求所占带宽，能够节省可观的资源。
*总之，恰当的优化不仅能够改善站点的用户体验并且能够节省相当的资源利用*
<!--more-->
## 按粒度可从两个方面优化：页面级和代码级。
### 一、页面级
#### 1、减少 HTTP请求数
**问题：每个请求都是有成本的，既包含时间成本也包含资源成本**
1）、资源成本就是一个完整的请求都需要经过 `DNS寻址、与服务器建立连接、发送数据请求、等待服务器响应、接收数据响应` 这样一个 “漫长” 而复杂的过程。
2）、时间成本就是用户需要看到或者 “感受” 到这个资源是必须要等待这个过程结束的.资源上由于每个请求都需要携带数据，因此每个请求都需要占用带宽。另外，由于浏览器进行并发请求的请求数是有上限的。因此请求数多了以后，浏览器需要分批进行请求，因此会增加用户的等待时间，会给用户造成站点速度慢这样一个印象，即使可能用户能看到的第一屏的资源都已经请求完了，但是浏览器的进度条会一直存在。
**解决**
1）、从设计实现层面简化页面
如果你的页面像百度首页一样简单，那么接下来的规则基本上都用不着了。保持页面简洁、减少资源的使用时最直接的。
2）、合理设置 HTTP缓存
缓存的力量是强大的，恰当的缓存设置可以大大的减少 HTTP请求。 (这里需要说明的是，如果直接F5刷新页面的话效果是不一样的，这种情况下请求数还是一样，不过被缓存资源的请求服务器是 304响应，只有 Header没有Body ，可以节省带宽)
怎样才算合理设置 ?原则很简单，能缓存越多越好，能缓存越久越好。例如，很少变化的图片资源可以直接通过 HTTP Header中的Expires设置一个很长的过期头 ;变化不频繁而又可能会变的资源可以使用 Last-Modifed来做请求验证。尽可能的让资源能够在缓存中待得更久。
3）、资源合并与压缩
如果可以的话，尽可能的将外部的脚本、样式进行合并，多个合为一个。另外， CSS、 Javascript、Image 都可以用相应的工具进行压缩，压缩后往往能省下不少空间。
4）、 CSS Sprites
合并 CSS图片，减少请求数的又一个好办法。
5）、Inline Images　　
使用 `data: URL scheme`的方式将图片嵌入到页面或 CSS中，如果不考虑资源管理上的问题的话，不失为一个好办法。如果是嵌入页面的话换来的是增大了页面的体积，而且无法利用浏览器缓存。使用在 CSS中的图片则更为理想一些。
6）、Lazy Load Images
这条策略实际上并不一定能减少 HTTP请求数，但是却能在某些条件下或者页面刚加载时减少 HTTP请求数。对于图片而言，在页面刚加载的时候可以只加载第一屏，当用户继续往后滚屏的时候才加载后续的图片。这样一来，假如用户只对第一屏的内容感兴趣时，那剩余的图片请求就都节省了。
#### 2、将外部脚本置底（将脚本内容在页面信息内容加载后再加载）
前文有谈到，浏览器是可以并发请求的，这一特点使得其能够更快的加载资源，然而外链脚本在加载时却会阻塞其他资源，例如在脚本加载完成之前，它后面的图片、样式以及其他脚本都处于阻塞状态，直到脚本加载完成后才会开始加载。如果将脚本放在比较靠前的位置，则会影响整个页面的加载速度从而影响用户体验。解决这一问题的方法有很多，而最简单可依赖的方法就是将脚本尽可能的往后挪，减少对并发下载的影响。
#### 3、异步执行inline脚本
inline脚本对性能的影响与外部脚本相比，是有过之而无不及。首页，与外部脚本一样， inline脚本在执行的时候一样会阻塞并发请求，除此之外，由于浏览器在页面处理方面是单线程的，当 inline脚本在页面渲染之前执行时，页面的渲染工作则会被推迟。简而言之， inline脚本在执行的时候，页面处于空白状态。鉴于以上两点原因，建议将执行时间较长的 inline脚本异步执行，异步的方式有很多种，例如使用 script元素的defer 属性(存在兼容性问题和其他一些问题，例如不能使用 document.write)、使用setTimeout ，此外，在HTML5中引入了 Web Workers的机制，恰恰可以解决此类问题。
#### 4、Lazy Load Javascript（只有在需要加载的时候加载，在一般情况下并不加载信息内容。）　　
随着 Javascript框架的流行，越来越多的站点也使用起了框架。不过，一个框架往往包括了很多的功能实现，这些功能并不是每一个页面都需要的，如果下载了不需要的脚本则算得上是一种资源浪费 -既浪费了带宽又浪费了执行花费的时间。目前的做法大概有两种，一种是为那些流量特别大的页面专门定制一个专用的 mini版框架，另一种则是 Lazy Load。YUI 则使用了第二种方式，在 YUI的实现中，最初只加载核心模块，其他模块可以等到需要使用的时候才加载。
#### 5、将 CSS放在 HEAD中　　
如果将 CSS放在其他地方比如 BODY中，则浏览器有可能还未下载和解析到 CSS就已经开始渲染页面了，这就导致页面由无 CSS状态跳转到 CSS状态，用户体验比较糟糕。除此之外，有些浏览器会在 CSS下载完成后才开始渲染页面，如果 CSS放在靠下的位置则会导致浏览器将渲染时间推迟。
#### 6、减少不必要的 HTTP跳转　　
对于以目录形式访问的 HTTP链接，很多人都会忽略链接最后是否带 ’/'，假如你的服务器对此是区别对待的话，那么你也需要注意，这其中很可能隐藏了 301跳转，增加了多余请求。具体参见下图，其中第一个链接是以无 ’/'结尾的方式访问的，于是服务器有了一次跳转。
#### 7、避免重复的资源请求
这种情况主要是由于疏忽或页面由多个模块拼接而成，然后每个模块中请求了同样的资源时，会导致资源的重复请求


### 二、代码级
#### 1、Javascript
###### 1）、DOM
Reflow & Repaint
###### 2）、慎用 with
###### 3）、避免使用 eval和 Function
###### 4）、减少作用域链查找（这方面设计到一些内容的相关问题）
###### 5）、数据访问
###### 6）、字符串拼接
#### 2、Css选择符
这样一个选择符，如果是从右往左解析则效率会很高，因为第一个 ID选择基本上就把查找的范围限定了，但实际上浏览器对选择符的解析是从右往左进行的。如上面的选择符，浏览器必须遍历查找每一个 A标签的祖先节点，效率并不像之前想象的那样高。根据浏览器的这一行为特点，在写选择符的时候需要注意很多事项。
#### 3. HTML
#### 4、Image压缩

### 三、其他
* CDN
* Gzip
* 多域名
* 无Cookie服务器
* 应用性能分析
* 使用负载均衡方案
nginx + tomcat集群，使用haship负载均衡方案可以避免sesson丢失。
因为使用负载均衡，上传文件不要直接上传到tomcat目录下，可以通过ftp统一上传到单独的文件服务器。
* 为了更快的启动时间考虑一下同构
* 优化sql语句，避免使用distinct，in，select *等
* 使用索引加速数据库查询
* 使用更快的转译方案
* sql缓存